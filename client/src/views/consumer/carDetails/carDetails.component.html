<div ng-controller="BookingController" ng-init="init()" class="container-fluid" style="padding: 0; overflow-x: hidden;">
    <main>
        <button go-Back class="btn btn-primary" style="background: linear-gradient(135deg, #007bff, #388fec); border: none; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: all 0.3s ease; position: fixed; top: 15px; left: 15px; z-index: 1000; font-size: 16px; padding: 8px 15px;">
            <i class="fa fa-arrow-left"></i> Back
        </button>

        <div id="page-loading" ng-if="!car" class="text-center" style="padding-top: 120px;">
            <img style="margin: 0 auto; display: block; width: 100px; height: 100px;" src="/src/assets/images/Pulse@1x-1.0s-200px-200px.gif" />
            <p style="margin-top: 20px; color: #555; font-size: 16px;">Loading car details...</p>
        </div>

        <div ng-if="car">
            <section class="hero-section" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); width: 100%; padding: 60px 0 40px 0; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
                <div class="container-fluid" style="max-width: 1200px; margin: 0 auto;">
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <h2 style="color: #007bff; font-weight: 600; margin: 15px 0; font-size: 32px; text-shadow: 0 1px 2px rgba(0,0,0,0.05);">{{ car.carData.carMake }} - {{ car.carData.carModel }}</h2>
                            <div style="margin-bottom: 25px;">
                                <span class="badge" style="background: linear-gradient(135deg, #007bff, #0056b3); margin-right: 15px; padding: 8px 16px; border-radius: 30px; font-size: 14px; font-weight: 500; box-shadow: 0 2px 5px rgba(0,123,255,0.3);">{{ car.carData.carCategory }}</span>
                                <span class="badge" style="background: linear-gradient(135deg, #28a745, #1e7e34); padding: 8px 16px; border-radius: 30px; font-size: 14px; font-weight: 500; box-shadow: 0 2px 5px rgba(40,167,69,0.3);">{{ car.carData.carcity }}</span>
                            </div>
                            <p style="color: #555; font-size: 16px; max-width: 700px; margin: 0 auto; line-height: 1.6;">Experience the perfect blend of style, performance, and comfort with this {{ car.carData.carYear }} {{ car.carData.carMake }} {{ car.carData.carModel }}.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section style="padding: 0 0 50px; background-color: #f8f9fa; width: 100%;">
                <div class="container-fluid" style="max-width: 1200px; margin: 0 auto; padding: 0 15px;">
                    <div class="row equal-height-container">
                        <div class="col-lg-8 col-md-7 d-flex flex-column">
                            <!-- Car Image Carousel -->
                            <div class="panel panel-info" style="border-radius: 8px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); border: none; transition: all 0.3s ease; margin-bottom: 25px; background-color: white;">
                                <div class="panel-heading" style="color: #333; border-radius: 8px 8px 0 0; padding: 15px 20px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-bottom: 1px solid rgba(0,0,0,0.05);">
                                    <h3 style="margin: 0; font-size: 18px; font-weight: 500;"><i class="fa fa-car" style="color: #007bff; margin-right: 10px;"></i>Car Images</h3>
                                </div>
                                <div class="panel-body" style="padding: 0;">
                                    <div uib-carousel interval="3000" no-wrap="false" style="border-radius: 0 0 8px 8px;">
                                        <div uib-slide class="text-center" ng-repeat="image in car.images track by $index" index="$index">
                                            <img ng-src="{{ image }}" style="height: 400px; max-height: 400px; object-fit: cover; width: 100%;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Car Details Panel -->
                            <div class="panel panel-info flex-grow-1" style="border-radius: 8px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); border: none; transition: all 0.3s ease; margin-bottom: 25px; background-color: white; display: flex; flex-direction: column;">
                                <div class="panel-heading" style="color: #333; border-radius: 8px 8px 0 0; padding: 15px 20px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-bottom: 1px solid rgba(0,0,0,0.05);">
                                    <h3 style="margin: 0; font-size: 18px; font-weight: 500;"><i class="fa fa-info-circle" style="color: #007bff; margin-right: 10px;"></i>Car Details</h3>
                                </div>
                                <div class="panel-body" style="padding: 25px 20px; flex-grow: 1; display: flex; flex-direction: column;">
                                    <div class="detail-sections" style="flex-grow: 1;">
                                        <!-- Section: Basic Information -->
                                        <div class="detail-section" style="margin-bottom: 25px;">
                                            <h4 style="font-size: 16px; color: #007bff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid #eee;">
                                                <i class="fa fa-car" style="margin-right: 8px;"></i> Basic Information
                                            </h4>
                                            <div class="row">
                                                <div class="col-md-6 col-sm-6" style="margin-bottom: a15px;">
                                                    <div class="detail-item">
                                                        <i class="fa fa-calendar" style="color: #007bff; width: 25px; text-align: center;"></i>
                                                        <strong style="color: #555; width: 100px;">Year:</strong> 
                                                        <span style="margin-left: 5px; flex-grow: 1;">{{ car.carData.carYear }}</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-sm-6" style="margin-bottom: 15px;">
                                                    <div class="detail-item">
                                                        <i class="fa fa-palette" style="color: #007bff; width: 25px; text-align: center;"></i>
                                                        <strong style="color: #555; width: 100px;">Color:</strong> 
                                                        <span class="color-box" style="display: inline-block; width: 20px; height: 20px; border-radius: 4px; vertical-align: middle; margin-left: 5px; border: 1px solid #ddd;" ng-style="{'background-color': car.carData.carColor}"></span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-sm-6" style="margin-bottom: 15px;">
                                                    <div class="detail-item">
                                                        <i class="fa fa-cog" style="color: #007bff; width: 25px; text-align: center;"></i>
                                                        <strong style="color: #555; width: 100px;">Transmission:</strong> 
                                                        <span style="margin-left: 5px; flex-grow: 1;">{{ car.carData.carTransmission }}</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-sm-6" style="margin-bottom: 15px;">
                                                    <div class="detail-item">
                                                        <i class="fa fa-tachometer-alt" style="color: #007bff; width: 25px; text-align: center;"></i>
                                                        <strong style="color: #555; width: 100px;">Mileage:</strong> 
                                                        <span style="margin-left: 5px; flex-grow: 1;">{{ car.carData.carMileage }} km</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-sm-6" style="margin-bottom: 15px;">
                                                    <div class="detail-item">
                                                        <i class="fa fa-tag" style="color: #007bff; width: 25px; text-align: center;"></i>
                                                        <strong style="color: #555; width: 100px;">Category:</strong> 
                                                        <span style="margin-left: 5px; flex-grow: 1;">{{ car.carData.carCategory }}</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-sm-6" style="margin-bottom: 15px;">
                                                    <div class="detail-item">
                                                        <i class="fa fa-map-marker-alt" style="color: #007bff; width: 25px; text-align: center;"></i>
                                                        <strong style="color: #555; width: 100px;">City:</strong> 
                                                        <span style="margin-left: 5px; flex-grow: 1;">{{ car.carData.carcity }}</span>
                                                    </div>
                                                </div>
        </div>
        </div>

                                        <!-- Section: Pricing Information -->
                                        <div class="detail-section" style="margin-bottom: 25px;">
                                            <h4 style="font-size: 16px; color: #007bff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid #eee;">
                                                <i class="fa fa-dollar-sign" style="margin-right: 8px;"></i> Pricing Information
                                            </h4>
                                            <div class="row">
                                                <div class="col-md-6 col-sm-6" style="margin-bottom: 15px;">
                                                    <div class="detail-item">
                                                        <i class="fa fa-tag" style="color: #007bff; width: 25px; text-align: center;"></i>
                                                        <strong style="color: #555; width: 100px;">Base (Local):</strong> 
                                                        <span style="margin-left: 5px; color: #28a745; font-weight: 500; flex-grow: 1;">${{ car.carData.basePrice }}/day</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-sm-6" style="margin-bottom: 15px;">
                                                    <div class="detail-item">
                                                        <i class="fa fa-road" style="color: #007bff; width: 25px; text-align: center;"></i>
                                                        <strong style="color: #555; width: 100px;">Base (Outstation):</strong> 
                                                        <span style="margin-left: 5px; color: #28a745; font-weight: 500; flex-grow: 1;">{{ car.carData.outstationPrice ? '$' + car.carData.outstationPrice + '/day' : 'NA' }}</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-sm-6" style="margin-bottom: 15px;">
                                                    <div class="detail-item">
                                                        <i class="fa fa-dollar-sign" style="color: #007bff; width: 25px; text-align: center;"></i>
                                                        <strong style="color: #555; width: 100px;">Extra (Local):</strong> 
                                                        <span style="margin-left: 5px; flex-grow: 1;">$50 per 100 km</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-sm-6" style="margin-bottom: 15px;">
                                                    <div class="detail-item">
                                                        <i class="fa fa-dollar-sign" style="color: #007bff; width: 25px; text-align: center;"></i>
                                                        <strong style="color: #555; width: 100px;">Extra (Outstation):</strong> 
                                                        <span style="margin-left: 5px; flex-grow: 1;">$100 per 100 km</span>
                </div>
            </div>
        </div>
        </div>

                                        <!-- Section: Location -->
                                        <div class="detail-section">
                                            <h4 style="font-size: 16px; color: #007bff; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid #eee;">
                                                <i class="fa fa-map-marked-alt" style="margin-right: 8px;"></i> Location & Contact
                                            </h4>
                                            <div class="row">
                                                <div class="col-md-12" style="margin-bottom: 15px;">
                                                    <div class="detail-item">
                                                        <i class="fa fa-map-marker-alt" style="color: #007bff; width: 25px; text-align: center;"></i>
                                                        <strong style="color: #555; width: 100px;">Address:</strong> 
                                                        <span style="margin-left: 5px; flex-grow: 1;">{{ car.carData.carAddress }}</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-12" style="margin-bottom: 15px;">
                                                    <div class="detail-item">
                                                        <i class="fa fa-user" style="color: #007bff; width: 25px; text-align: center;"></i>
                                                        <strong style="color: #555; width: 100px;">Owner Email:</strong> 
                                                        <span style="margin-left: 5px; flex-grow: 1;">{{ car.ownerDetails.ownerEmail }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4 col-md-5 d-flex flex-column">
                            <!-- Booking Form Panel -->
                            <div class="panel panel-info" style="border-radius: 8px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); border: none; transition: all 0.3s ease; background-color: white; margin-bottom: 25px; display: flex; flex-direction: column;">
                                <div class="panel-heading" style="color: #333; border-radius: 8px 8px 0 0; padding: 15px 20px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-bottom: 1px solid rgba(0,0,0,0.05);">
                                    <h3 style="margin: 0; font-size: 18px; font-weight: 500; text-align: center;"><i class="fa fa-bookmark" style="color: #007bff; margin-right: 10px;"></i>Book This Car</h3>
                                </div>
                                <div class="panel-body" style="padding: 25px 20px;">
                                    <form>
                                        <div class="form-group" style="margin-bottom: 25px;">
                                            <label style="color: #555; font-weight: 500; margin-bottom: 10px; display: block;">
                                                <i class="fa fa-route" style="color: #007bff; width: 22px; text-align: center;"></i> Trip Type
                                            </label>
                                            <select class="form-control" ng-model="bidplace.triptype" ng-change="tochange(e)" required style="height: 45px; border-radius: 4px; border: 1px solid #ddd; padding-left: 12px; width: 100%; box-shadow: none;">
                                                <option value="local">Local</option>
                <option value="outstation">Outstation</option>
            </select>
            </div>

                                        <div class="form-group" style="margin-bottom: 25px;">
                                            <label style="color: #555; font-weight: 500; margin-bottom: 10px; display: block;">
                                                <i class="fa fa-calendar-alt" style="color: #007bff; width: 22px; text-align: center;"></i> Start Date
                                            </label>
                                            <input type="date" class="form-control" ng-model="bidplace.startDate" ng-change="checkDate(bidplace.startDate)" min="{{date | date:'yyyy-MM-dd'}}" style="height: 45px; border-radius: 4px; border: 1px solid #ddd; padding: 0 12px; width: 100%; box-shadow: none;">
            </div>

                                        <div class="form-group" style="margin-bottom: 25px;">
                                            <label style="color: #555; font-weight: 500; margin-bottom: 10px; display: block;">
                                                <i class="fa fa-calendar-check" style="color: #007bff; width: 22px; text-align: center;"></i> End Date
                                            </label>
                                            <input type="date" class="form-control" ng-model="bidplace.endDate" min="{{bidplace.startDate | date:'yyyy-MM-dd'}}" ng-change="checkDate(bidplace.endDate)" style="height: 45px; border-radius: 4px; border: 1px solid #ddd; padding: 0 12px; width: 100%; box-shadow: none;">
            </div>

                                        <div class="form-group" style="margin-bottom: 25px;">
                                            <label style="color: #555; font-weight: 500; margin-bottom: 10px; display: block;">
                                                <i class="fa fa-money-bill-wave" style="color: #007bff; width: 22px; text-align: center;"></i> Your Bid Amount
                                            </label>
                                            <div style="position: relative; width: 100%;">
                                                <div style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #495057; z-index: 10;">$</div>
                                                <input type="number" class="form-control" placeholder="Enter your bid amount" ng-model="bidplace.bidAmount" required style="height: 45px; border-radius: 4px; border: 1px solid #ddd; padding: 0 12px 0 25px; width: 100%; box-shadow: none;">
                                            </div>
        </div>

                                        <button type="button" class="btn btn-primary btn-block" ng-click="bookCar()" style="background: linear-gradient(135deg, #007bff, #0056b3); border: none; border-radius: 4px; padding: 12px 15px; margin-top: 15px; font-weight: 500; transition: all 0.3s ease; height: 50px;">
                                            <i class="fa fa-check-circle" style="margin-right: 8px;"></i> Book Now
                                        </button>
                                    </form>
                                </div>
                            </div>

                            <!-- Chat Panel -->
                            <div class="panel panel-info flex-grow-1" style="border-radius: 8px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); border: none; transition: all 0.3s ease; background-color: white; display: flex; flex-direction: column;">
                                <div class="panel-heading" style="color: #333; border-radius: 8px 8px 0 0; padding: 15px 20px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-bottom: 1px solid rgba(0,0,0,0.05);">
                                    <h3 style="margin: 0; font-size: 18px; font-weight: 500;"><i class="fa fa-comments" style="color: #007bff; margin-right: 10px;"></i>Chat with Owner</h3>
                                </div>
                                <div class="panel-body" style="padding: 0; flex-grow: 1; display: flex; flex-direction: column; min-height: 400px;">
                                    <div class="chat-window" style="flex: 1; overflow-y: auto; padding: 20px; background-color: #f8f9fa;">
                                        <div ng-repeat="msg in chat.chatMessages" style="margin-bottom: 15px;">
                                            <img ng-if="msg.isImage" ng-src="{{ msg.chatString }}" style="max-width: 80%; border-radius: 8px; margin: 5px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1);" ng-class="{'float-right': msg.sentBy === 'user', 'float-left': msg.sentBy !== 'user'}">
                                            <div ng-if="!msg.isImage" style="padding: 12px 15px; border-radius: 18px; max-width: 80%; clear: both; box-shadow: 0 2px 5px rgba(0,0,0,0.1);" ng-class="{'float-right bg-primary text-white': msg.sentBy === 'user', 'float-left bg-light': msg.sentBy !== 'user'}">
                        {{ msg.chatString }}
                                            </div>
                                            <div style="clear: both;"></div>
                                        </div>
                                        <div ng-if="chat.chatMessages.length === 0" class="text-center text-muted" style="padding: 30px 20px;">
                                            <i class="fa fa-comments" style="font-size: 36px; color: #ddd; margin-bottom: 15px; display: block;"></i>
                                            No messages yet. Start the conversation!
                                        </div>
                                    </div>
                                    <div class="input-group" style="padding: 15px 20px; border-top: 1px solid #eee; margin-top: auto;">
                                        <input type="text" class="form-control" placeholder="Type a message..." ng-model="chat.chatMessage" style="border-radius: 4px 0 0 4px; border: 1px solid #ddd; height: 45px; box-shadow: none;">
                                        <span class="input-group-btn">
                                            <button class="btn btn-primary" ng-click="sendMessage()" style="height: 45px; border-radius: 0 4px 4px 0; background: linear-gradient(135deg, #007bff, #0056b3); border: none; padding: 0 15px;">
                                                <i class="fa fa-paper-plane"></i> Send
                                            </button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
    </div>

        <p ng-if="!car && !isLoading" class="text-center" style="padding: 100px 0; color: #dc3545; font-size: 18px;">Car listing not found.</p>
    </main>
</div>

<style>
    body {
        background-color: #f8f9fa;
        overflow-x: hidden;
    }
    
    .panel {
        transition: all 0.3s ease;
    }
    
    .panel:hover {
        box-shadow: 0 12px 25px rgba(0,0,0,0.15);
    }
    
    .detail-item {
        padding: 8px 0;
        display: flex;
        align-items: center;
    }
    
    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        outline: none;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .chat-window::-webkit-scrollbar {
        width: 6px;
    }
    
    .chat-window::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    
    .chat-window::-webkit-scrollbar-thumb {
        background: #b8b8b8;
        border-radius: 10px;
    }
    
    .chat-window::-webkit-scrollbar-thumb:hover {
        background: #007bff;
    }
    
    .bg-primary {
        background-color: #007bff !important;
    }
    
    .bg-light {
        background-color: #e9ecef !important;
    }
    
    .float-right {
        float: right;
    }
    
    .float-left {
        float: left;
    }
    
    .text-white {
        color: white !important;
    }
    
    .d-flex {
        display: flex !important;
    }
    
    .flex-column {
        flex-direction: column !important;
    }
    
    .flex-grow-1 {
        flex-grow: 1 !important;
    }
    
    .equal-height-container {
        display: flex;
        flex-wrap: wrap;
    }
    
    .equal-height-container > [class*="col-"] {
        display: flex;
        flex-direction: column;
    }
    
    @media (max-width: 991px) {
        .panel-heading h3 {
            font-size: 16px;
        }
        
        .detail-item {
            font-size: 14px;
        }
        
        .col-lg-4 {
            margin-top: 25px;
        }
        
        .equal-height-container {
            display: block;
        }
    }
    
    @media (max-width: 768px) {
        .hero-section {
            padding: 60px 0 25px 0 !important;
        }
        
        h2 {
            font-size: 24px !important;
        }
    }
    
    .detail-item {
        padding: 8px 0;
        display: flex;
        align-items: center;
    }
    
    .detail-section h4 {
        font-weight: 500;
        position: relative;
    }
    
    .detail-section h4 i {
        position: relative;
        top: 1px;
    }
    
    @media (max-width: 767px) {
        .detail-item strong {
            width: auto !important;
            min-width: 80px;
        }
    }
    
    @media (min-width: 992px) {
        .equal-height-container .panel-body.chat-panel-body {
            display: flex;
            flex-direction: column;
        }
        
        .equal-height-container .chat-window {
            flex: 1;
            min-height: 380px;
        }
    }
</style>

